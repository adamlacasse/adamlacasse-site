---
import BaseLayout from './BaseLayout.astro';
import { AUTHOR } from '../consts';

const {
  title,
  description,
  pubDate,
  updatedDate,
  tags = [],
} = Astro.props as {
  title: string;
  description?: string;
  pubDate?: Date;
  updatedDate?: Date;
  tags?: string[];
};

const siteBase = Astro.site ?? new URL('/', 'http://localhost');
const canonicalURL = new URL(Astro.url.pathname, siteBase).toString();
const linkedinShareURL = new URL('https://www.linkedin.com/shareArticle');
linkedinShareURL.searchParams.set('mini', 'true');
linkedinShareURL.searchParams.set('url', canonicalURL);
linkedinShareURL.searchParams.set('title', title);
if (description) {
  linkedinShareURL.searchParams.set('summary', description);
}
---

<BaseLayout title={`${title} — ${AUTHOR}`} description={description} contentWidth="narrow">
  <article>
    <header class="mb-5">
      <h1 class="title is-2">{title}</h1>
      <p class="subtitle is-6 has-text-grey">
        <time datetime={pubDate?.toISOString()}>
          {
            pubDate?.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
            })
          }
        </time>
        {
          updatedDate && (
            <>
              {' · updated '}
              <time datetime={updatedDate.toISOString()}>
                {updatedDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric',
                })}
              </time>
            </>
          )
        }
      </p>
      {
        tags.length > 0 && (
          <div class="tags">
            {tags.map((t) => (
              <span class="tag is-info is-light">{t}</span>
            ))}
          </div>
        )
      }
      <div class="mt-3">
        <a
          href={linkedinShareURL.toString()}
          rel="noopener"
          target="_blank"
          class="button is-small is-link is-light"
        >
          Share on LinkedIn
        </a>
      </div>
    </header>

    <div class="content">
      <slot />
    </div>
  </article>
</BaseLayout>
