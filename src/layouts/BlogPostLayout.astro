---
import BaseLayout from './BaseLayout.astro';
import { AUTHOR } from '../consts';

const {
  title,
  description,
  pubDate,
  updatedDate,
  tags = [],
} = Astro.props as {
  title: string;
  description?: string;
  pubDate?: Date;
  updatedDate?: Date;
  tags?: string[];
};

const siteBase = Astro.site ?? new URL('/', 'http://localhost');
const canonicalURL = new URL(Astro.url.pathname, siteBase).toString();
const linkedinShareURL = new URL('https://www.linkedin.com/shareArticle');
linkedinShareURL.searchParams.set('mini', 'true');
linkedinShareURL.searchParams.set('url', canonicalURL);
linkedinShareURL.searchParams.set('title', title);
if (description) {
  linkedinShareURL.searchParams.set('summary', description);
}
---

<BaseLayout title={`${title} — ${AUTHOR}`} description={description}>
  <article class="prose">
    <header>
      <h1>{title}</h1>
      <div class="post-meta">
        <time datetime={pubDate?.toISOString()}>
          {
            pubDate?.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
            })
          }
        </time>
        {
          updatedDate && (
            <>
              {' · updated '}
              <time datetime={updatedDate.toISOString()}>
                {updatedDate.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric',
                })}
              </time>
            </>
          )
        }
      </div>
      {
        tags.length > 0 && (
          <div class="post-tags">
            {tags.map((t) => (
              <span class="post-tag">{t}</span>
            ))}
          </div>
        )
      }
      <div class="post-share">
        <a href={linkedinShareURL.toString()} rel="noopener" target="_blank">
          Share on LinkedIn
        </a>
      </div>
    </header>

    <div class="prose-content">
      <slot />
    </div>
  </article>
</BaseLayout>
