---
import { Image } from 'astro:assets';
import { AUTHOR, SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import logo from '../assets/lacasse-solutions.png';

interface Props {
  title?: string;
  description?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
  canonicalURL?: string;
  contentWidth?: 'wide' | 'narrow';
}

const {
  title = SITE_TITLE,
  description = SITE_DESCRIPTION,
  ogTitle,
  ogDescription,
  ogImage,
  canonicalURL: canonicalOverride,
  contentWidth = 'wide',
} = Astro.props as Props;

const siteBase = Astro.site ?? new URL('/', 'http://localhost');
const canonicalURL = (canonicalOverride ?? new URL(Astro.url.pathname, siteBase)).toString();
const siteUrl = new URL(canonicalURL);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={siteUrl.toString()} />
    <meta property="og:title" content={ogTitle || title} />
    <meta property="og:description" content={ogDescription || description} />
    {ogImage && <meta property="og:image" content={new URL(ogImage, Astro.site).toString()} />}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={siteUrl.toString()} />
    <meta property="twitter:title" content={ogTitle || title} />
    <meta property="twitter:description" content={ogDescription || description} />
    {ogImage && <meta property="twitter:image" content={new URL(ogImage, Astro.site).toString()} />}

    <meta name="color-scheme" content="light dark" />
    <link rel="icon" href="/pc.ico" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css" />
    <style>
      /* Sticky footer pattern */
      html,
      body {
        height: 100%;
      }
      body {
        display: flex;
        flex-direction: column;
      }
      main {
        flex: 1;
      }

      /* Footer overrides */
      .footer {
        margin-top: 24px;
        padding: 24px 0;
      }

      /* Theme toggle: keep the icon on a transparent canvas */
      #theme-toggle {
        background-color: transparent;
        border: none;
        box-shadow: none;
        color: inherit;
      }

      #theme-toggle:hover,
      #theme-toggle:focus-visible {
        background-color: transparent;
        border: none;
        box-shadow: none;
      }

      #theme-toggle:focus-visible {
        outline: 2px solid currentColor;
        outline-offset: var(--space-xs, 0.25rem);
      }

      .navbar-brand .navbar-item {
        height: auto;
      }

      header {
        /* border-bottom: 1px solid var(--color-border, #dbdbdb); */
        padding: 0 8rem;
      }

      #logo {
        /* height: 120px; */
        max-height: none;
        width: 250px;
      }
    </style>
    <script is:inline>
      // Initialize theme before page render to prevent flash
      (function () {
        const theme =
          localStorage.getItem('theme') ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>

  <body>
    <header>
      <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="container">
          <div class="navbar-brand">
            <a href="/" class="navbar-item">
              <Image id="logo" src={logo} alt={AUTHOR} />
            </a>
          </div>
          <div class="navbar-menu">
            <div class="navbar-end">
              <a class="navbar-item" href="/about">About</a>
              <a class="navbar-item" href="/now">Now</a>
              <a class="navbar-item" href="/projects">Projects</a>
              <a class="navbar-item" href="/blog">Writing</a>
              <a class="navbar-item" href="/contact">Contact</a>
              <div class="navbar-item">
                <button id="theme-toggle" class="button is-small" aria-label="Toggle theme">
                  <span class="icon is-small">
                    <span id="theme-icon">ðŸŒ™</span>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <main class="section">
      <div class="container">
        {
          contentWidth === 'narrow' ? (
            <div class="content" style="max-width: 75ch; margin: 0 auto;">
              <slot />
            </div>
          ) : (
            <div class="content">
              <slot />
            </div>
          )
        }
      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="content has-text-centered">
          <p>
            <small>Â© {new Date().getFullYear()} {AUTHOR}</small>
          </p>
          <p>
            <small>
              <a
                href="https://github.com/adamlacasse"
                target="_blank"
                rel="noreferrer"
                aria-label="GitHub profile"
              >
                GitHub
              </a>
              {' Â· '}
              <a
                href="https://www.linkedin.com/in/adamlacasse/"
                target="_blank"
                rel="noreferrer"
                aria-label="LinkedIn profile"
              >
                LinkedIn
              </a>
              {' Â· '}
              <a href="/rss.xml" aria-label="RSS feed"> RSS </a>
            </small>
          </p>
        </div>
      </div>
    </footer>

    <script is:inline>
      // Theme toggle functionality
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');

      function updateThemeIcon(theme) {
        if (themeIcon) {
          themeIcon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        }
      }

      // Set initial icon
      const currentTheme = document.documentElement.getAttribute('data-theme');
      if (currentTheme) {
        updateThemeIcon(currentTheme);
      }

      // Toggle theme on button click
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme');
          const newTheme = current === 'dark' ? 'light' : 'dark';

          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          updateThemeIcon(newTheme);
        });
      }
    </script>
  </body>
</html>
