---
import { Image } from 'astro:assets';
import { AUTHOR, SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import logo from '../assets/lacasse-solutions.png';
import githubIconBlack from '../assets/GitHub_Invertocat_Black.svg';
import githubIconWhite from '../assets/GitHub_Invertocat_White.svg';
import linkedinIcon from '../assets/LI-In-Bug.png';
import rssIcon from '../assets/Feed-icon.png';
import 'bulma/css/bulma.min.css';

interface Props {
  title?: string;
  description?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
  canonicalURL?: string;
  contentWidth?: 'wide' | 'narrow';
}

const {
  title = SITE_TITLE,
  description = SITE_DESCRIPTION,
  ogTitle,
  ogDescription,
  ogImage,
  canonicalURL: canonicalOverride,
  contentWidth = 'wide',
} = Astro.props as Props;

const siteBase = Astro.site ?? new URL('/', 'http://localhost');
const canonicalURL = (canonicalOverride ?? new URL(Astro.url.pathname, siteBase)).toString();
const siteUrl = new URL(canonicalURL);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={siteUrl.toString()} />
    <meta property="og:title" content={ogTitle || title} />
    <meta property="og:description" content={ogDescription || description} />
    {ogImage && <meta property="og:image" content={new URL(ogImage, Astro.site).toString()} />}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={siteUrl.toString()} />
    <meta property="twitter:title" content={ogTitle || title} />
    <meta property="twitter:description" content={ogDescription || description} />
    {ogImage && <meta property="twitter:image" content={new URL(ogImage, Astro.site).toString()} />}

    <meta name="color-scheme" content="light dark" />
    <link rel="icon" href="/pc.ico" />
    <style>
      /* Sticky footer pattern */
      html,
      body {
        height: 100%;
      }
      body {
        display: flex;
        flex-direction: column;
      }
      main {
        flex: 1;
      }

      /* Footer overrides */
      .footer {
        margin-top: 24px;
        padding: 24px 0;
      }

      /* Theme toggle: keep the icon on a transparent canvas */
      #theme-toggle {
        background-color: transparent;
        border: none;
        box-shadow: none;
        color: inherit;
      }

      #theme-toggle:hover,
      #theme-toggle:focus-visible {
        background-color: transparent;
        border: none;
        box-shadow: none;
      }

      #theme-toggle:focus-visible {
        outline: 2px solid currentColor;
        outline-offset: var(--space-xs, 0.25rem);
      }

      .navbar-brand .navbar-item {
        height: auto;
      }

      header {
        position: relative;
        padding-top: 26px;
      }

      #logo {
        max-height: none;
        width: 250px;
      }

      /* Mobile menu overlay */
      @media screen and (max-width: 1023px) {
        .navbar-menu.is-active {
          position: absolute;
          top: 100%;
          left: 0;
          right: 0;
          z-index: 100;
          box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
      }

      /* Social links styling */
      .social-links {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        align-items: center;
      }

      .social-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: opacity 0.2s ease;
      }

      .social-icon:hover {
        opacity: 0.7;
      }

      .social-icon img {
        display: block;
      }

      /* GitHub icon theme switching */
      .github-light {
        display: block;
      }

      .github-dark {
        display: none;
      }

      @media (prefers-color-scheme: dark) {
        .github-light {
          display: none;
        }

        .github-dark {
          display: block;
        }
      }

      html[data-theme='light'] .github-light {
        display: block;
      }

      html[data-theme='light'] .github-dark {
        display: none;
      }

      html[data-theme='dark'] .github-light {
        display: none;
      }

      html[data-theme='dark'] .github-dark {
        display: block;
      }
    </style>
    <script is:inline>
      // Initialize theme before page render to prevent flash
      (function () {
        const theme =
          localStorage.getItem('theme') ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>

  <body>
    <header>
      <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="container">
          <div class="navbar-brand">
            <a href="/" class="navbar-item">
              <Image id="logo" src={logo} alt={AUTHOR} />
            </a>
            <a
              role="button"
              class="navbar-burger"
              aria-label="menu"
              aria-expanded="false"
              data-target="navbarMenu"
            >
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
            </a>
          </div>
          <div id="navbarMenu" class="navbar-menu">
            <div class="navbar-end">
              <a class="navbar-item" href="/about">About</a>
              <a class="navbar-item" href="/now">Now</a>
              <a class="navbar-item" href="/projects">Projects</a>
              <a class="navbar-item" href="/blog">Writing</a>
              <a class="navbar-item" href="/contact">Contact</a>
              <div class="navbar-item">
                <button id="theme-toggle" class="button is-small" aria-label="Toggle theme">
                  <span class="icon is-small">
                    <span id="theme-icon">ðŸŒ™</span>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <main class="section">
      <div class="container">
        {
          contentWidth === 'narrow' ? (
            <div class="content" style="max-width: 75ch; margin: 0 auto;">
              <slot />
            </div>
          ) : (
            <div class="content">
              <slot />
            </div>
          )
        }
      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="content has-text-centered">
          <p>
            <small>Â© {new Date().getFullYear()} {AUTHOR}</small>
          </p>
          <p class="social-links">
            <a
              href="https://github.com/adamlacasse"
              target="_blank"
              rel="noreferrer"
              aria-label="GitHub profile"
              class="social-icon"
            >
              <Image
                src={githubIconBlack}
                alt="GitHub"
                width={24}
                height={24}
                class="github-light"
              />
              <Image
                src={githubIconWhite}
                alt="GitHub"
                width={24}
                height={24}
                class="github-dark"
              />
            </a>
            <a
              href="https://www.linkedin.com/in/adamlacasse/"
              target="_blank"
              rel="noreferrer"
              aria-label="LinkedIn profile"
              class="social-icon"
            >
              <Image src={linkedinIcon} alt="LinkedIn" width={24} height={24} />
            </a>
            <a href="/rss.xml" aria-label="RSS feed" class="social-icon">
              <Image src={rssIcon} alt="RSS Feed" width={24} height={24} />
            </a>
          </p>
        </div>
      </div>
    </footer>

    <script is:inline>
      // Theme toggle functionality
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');

      function updateThemeIcon(theme) {
        if (themeIcon) {
          themeIcon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        }
      }

      // Set initial icon
      const currentTheme = document.documentElement.getAttribute('data-theme');
      if (currentTheme) {
        updateThemeIcon(currentTheme);
      }

      // Toggle theme on button click
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme');
          const newTheme = current === 'dark' ? 'light' : 'dark';

          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
          updateThemeIcon(newTheme);
        });
      }

      // Mobile menu toggle functionality
      document.addEventListener('DOMContentLoaded', () => {
        // Get all "navbar-burger" elements
        const $navbarBurgers = Array.prototype.slice.call(
          document.querySelectorAll('.navbar-burger'),
          0
        );

        // Function to close all menus
        const closeAllMenus = () => {
          $navbarBurgers.forEach((el) => {
            const target = el.dataset.target;
            const $target = document.getElementById(target);
            el.classList.remove('is-active');
            $target.classList.remove('is-active');
          });
        };

        // Add a click event on each of them
        $navbarBurgers.forEach((el) => {
          el.addEventListener('click', () => {
            // Get the target from the "data-target" attribute
            const target = el.dataset.target;
            const $target = document.getElementById(target);

            // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
            el.classList.toggle('is-active');
            $target.classList.toggle('is-active');
          });
        });

        // Close menu on escape key
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape') {
            closeAllMenus();
          }
        });

        // Close menu when clicking outside
        document.addEventListener('click', (event) => {
          const isClickInsideMenu =
            event.target.closest('.navbar-menu') || event.target.closest('.navbar-burger');
          if (!isClickInsideMenu) {
            closeAllMenus();
          }
        });
      });
    </script>
  </body>
</html>
